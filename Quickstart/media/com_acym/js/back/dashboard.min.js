/**
 * @package    AcyMailing for Joomla
 * @version    6.1.2
 * @author     acyba.com
 * @copyright  (C) 2009-2019 ACYBA S.A.R.L. All rights reserved.
 * @license    GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
 */

jQuery(document).ready(function(_){var a,e,t,c,i,s,r,m=0,l=0,o=0,n=0,h=500,g=10,u=0,y=0,d=0;function f(){var a=_("#acym__migrate__mails").is(":checked");a?_("#acym__migrate__input__global_stats").show():_("#acym__migrate__input__global_stats").hide(),_("#acym__migrate__mailstats").prop("disabled",0==a),_("#acym__migrate__button").prop("disabled",0==_("input:checked").length)}function k(){_("#acym__migrate__no__button").prop("disabled",!0),_("#acym__migrate__button").prop("disabled",!0),_(".acym__migrate__option").prop("disabled",!0);var a={config:_("#acym__migrate__config").is(":checked")&&!_("#acym__migrate__config").hasClass("acym__migrate__migrate_with_success_element"),bounce:_("#acym__migrate__bounce").is(":checked")&&!_("#acym__migrate__bounce").hasClass("acym__migrate__migrate_with_success_element"),lists:_("#acym__migrate__lists").is(":checked")&&!_("#acym__migrate__lists").hasClass("acym__migrate__migrate_with_success_element"),mails:_("#acym__migrate__mails").is(":checked")&&!_("#acym__migrate__mails").hasClass("acym__migrate__migrate_with_success_element"),templates:_("#acym__migrate__templates").is(":checked")&&!_("#acym__migrate__templates").hasClass("acym__migrate__migrate_with_success_element"),fields:_("#acym__migrate__fields").is(":checked")&&!_("#acym__migrate__fields").hasClass("acym__migrate__migrate_with_success_element"),users:_("#acym__migrate__users").is(":checked")&&!_("#acym__migrate__users").hasClass("acym__migrate__migrate_with_success_element")};a.subscriptions=a.users&&a.lists,a.users_fields=a.users&&a.fields,a.mailstats=_("#acym__migrate__mailstats").is(":checked")&&!_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),a.mailhaslists=a.mails&&a.lists,a.welcomeunsub=a.mails&&a.lists;var e=[],t=[];a.mails,_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),a.mails&&a.lists,a.lists;_.each(a,function(_,a){if(!0===a){var c=AJAX_URL_ACYM+"&ctrl=dashboard&task=preMigration&element="+_;e.push(c),t.push(_)}}),_("#acym__migrate__all_checked_elements").val(JSON.stringify(t)),u=t.length,y=100/u,_(".acym__migration__need__display").show(),w(e,t)}function p(a,e,t,c,i){a?(_("#acym__migrate__error_element").val(e),_("#acym__migrate__result__"+e+"__check").html('<i class="fa fa-exclamation-circle acym__color__red"></i>'),"mails"==e&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="fa fa-exclamation-circle acym__color__red"></i>'),_("#acym__migrate__result__error__message").html(i),_("#acym__migrate__result__error").show()):(_("#acym__migrate__result__"+e+"__check").html('<i class="fa fa-check-circle acym__color__green"></i>'),"mails"==e&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="fa fa-check-circle acym__color__green"></i>'),_("#acym__migrate__"+e).addClass("acym__migrate__migrate_with_success_element"),w(t,c))}function w(a,e){if(0==a.length)return _("#acym__migration__progress__bar__inner").animate({width:"100%"}),_("#acym__migration__percentage").html("100%"),void _("#acym__migrate__result__ok").show();var t=e.shift().toLowerCase();_("#acym__migrate__result__"+t+"__check").html('<i class="fa fa-circle-o-notch fa-spin acym__color__blue"></i>');var c=a.shift();_.post(c,function(c){if("0"==c)d+=y,_("#acym__migration__progress__bar__inner").animate({width:Math.round(d)+"%"}),_("#acym__migration__percentage").html(Math.round(d)+"%"),p(!1,t,a,e,c);else if(-1!==c.indexOf("ERROR"))p(!0,t,a,e,c);else{l=0,n=0,m=Math.ceil(c/(h*g)),o=Math.ceil(c/h);!function a(e,t,c){for(var i=!1,s=[],r="",u=0;u<g&&!(n>o);u++){var f=n*h,k=_.post(AJAX_URL_ACYM+"&ctrl=dashboard&task=migrate&element="+e+"&currentElement="+f+"&insertPerCalls="+h);s.push(k),n++}return _.when.apply(_,s).then(function(){l++,d=y/m+d,_("#acym__migration__progress__bar__inner").animate({width:Math.round(d)+"%"}),_("#acym__migration__percentage").html(Math.round(d)+"%"),_.each(arguments,function(_,a){-1!==a[0].indexOf("ERROR")&&(i=!0,r=a[0],p(i,e,t,c,r))}),l===m?p(i,e,t,c,r):a(e,t,c)}),!0}(t,a,e)}}).fail(function(a){_("#acym__migrate__result").append("<br>ERROR AJAX. PLEASE REFRESH PAGE AND RETRY.")})}_(".acym__walk-through__select").select2({theme:"foundation",width:"100%"}),function a(){_(".acym__dashboard__active-campaings__one-campaing__action").off("click").on("click",function(){var e=AJAX_URL_ACYM+"&ctrl=campaigns&task=cancelDashboardAndGetCampaignsAjax&id="+_(this).attr("id");_.post(e,function(e){"error"==e?console.log(e):_(".acym__dashboard__active-campaings__listing").html(e),a()})})}(),_("#acym__walk-through-1__content__toggle-reply-to__checkbox").off("change").on("change",function(){_(".acym__walk-through-1__content__reply-to").toggle()}),a=_(".acym__walk-through-2__choose_your-server"),e=_(".acym__walk-through-2__choose_external-server"),t=_(".acym__walk-through-2__smtp-server"),c=_(".acym__walk-through-2__elastic-email"),i=_(".acym__walk-through-2__toggle-mail .acym__walk_through_toggle-span"),s=_(".acym__walk-through-2__choose_external-server .acym__walk_through_toggle-span"),i.off("click").on("click",function(){i.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"your-server"==_(this).attr("id")?a.show()&&e.hide()&&_("#acym__walk-through-2__way-mail").val(_(".your_server_selected").attr("id")):a.hide()&&e.show()&&_("#acym__walk-through-2__way-mail").val(_(".acym__walk-through-2__choose_external-server .walk-through_selected").attr("id"))}),s.off("click").on("click",function(){s.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"smtp"==_(this).attr("id")?t.show()&&c.hide():t.hide()&&c.show(),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),(r=_(".acym__walk-through-2__button")).off("click").on("click",function(a){a.preventDefault(),r.addClass("unselected").removeClass("your_server_selected"),_(this).removeClass("unselected").addClass("your_server_selected"),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),_(".acym__migrate__option").off("change").on("change",function(){f(),_(".acym__migrate__option:disabled").prop("checked",!1)}),f(),_("#acym__migrate__button").off("click").on("click",function(){k()}),_("#acym__migrate__restart_from_error__button").off("click").on("click",function(){window.scrollTo(0,0),_("#acym__migrate__result__error").hide(),_("#acym__migrate__result__error__message").html(""),k()}),_("#available_ports_check").off("click").on("click",function(a){a.preventDefault();var e=_(this).parent();e.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),_.get(AJAX_URL_ACYM+"&ctrl=configuration&task=ports",function(_){e.html(_)})})});