/**
 * @package    AcyMailing for Joomla
 * @version    6.1.2
 * @author     acyba.com
 * @copyright  (C) 2009-2019 ACYBA S.A.R.L. All rights reserved.
 * @license    GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
 */

jQuery(document).ready(function(e){var a,t,s,_,c,n,i=1;function l(a){var t=AJAX_URL_ACYM+"&page=acymailing_campaigns&ctrl=campaigns&task=countNumberOfRecipients";e.ajax({url:t,type:"GET",data:{listsSelected:a},beforeSend:function(){e(".acym__campaign__recipients__number-recipients").html('<i class="fa fa-circle-o-notch fa-spin"></i>')}}).done(function(a){e(".acym__campaign__recipients__number-recipients").html(a),a>0?e("#acym__campaign__recipients__save-continue").removeClass("disabled-button"):e("#acym__campaign__recipients__save-continue").addClass("disabled-button")}).error(function(){e(".acym__campaign__recipients__number-recipients").html(0)})}e(".acym__campaigns__filter__tags").select2({theme:"foundation",width:"100%"}),e(".acym__campaigns__filter__tags").on("select2:open",function(){e(".select2-search--dropdown .select2-search__field").attr("placeholder",ACYM_JS_TXT.ACYM_SEARCH_TAGS)}),e(".acym__campaign__recipients__all-lists").select2({width:"100%"}),e(".acym__templates__filter__tags").select2({theme:"foundation",width:"100%"}),e("#acym__campaigns__recipients").length&&(function(){if(0!=e("#acym__modal__lists-selected").length){var a=""==e("#acym__modal__lists-selected").attr("value")?[]:JSON.parse(e("#acym__modal__lists-selected").attr("value"));l(a)}}(),e("#acym__campaigns__recipients__event_on_change_count_recipients").off("change").on("change",function(){var a=""==e("#acym__modal__lists-selected").attr("value")?[]:JSON.parse(e("#acym__modal__lists-selected").attr("value"));l(a)})),e(".acym__campaign__listing__sending__stop").off("click").on("click",function(){var a=e("#acym_form"),t=e(this).attr("data-campaignid");a.append('<input type="hidden" name="stopSendingCampaignId" value="'+t+'">'),a.find('[name="task"]').val("stopSending"),a.submit()}),e(".acym__campaign__listing__scheduled__stop").off("click").on("click",function(){var a=e("#acym_form"),t=e(this).attr("data-campaignid");a.append('<input type="hidden" name="stopScheduledCampaignId" value="'+t+'">'),a.find('[name="task"]').val("stopScheduled"),a.submit()}),t=e(".acym__campaign__sendsettings__send-type--now"),s=e(".acym__campaign__sendsettings__send-type--sheduled"),_=e(".acym__campaign__sendsettings__display-send-type-now"),c=e(".acym__campaign__sendsettings__display-send-type-scheduled"),n=e("#acym__campaign__sendsettings__isScheduled"),s.hasClass("unselected")?(_.show(),c.hide()):(_.hide(),c.show()),e(".acym__campaign__sendsettings__send-type--now, .acym__campaign__sendsettings__send-type--sheduled").off("click").on("click",function(){if(s.hasClass("unselected")){if("acym__campaign__sendsettings__send-type--now"==e(this).attr("id"))return;_.hide(),c.show(),e("#acym__campaign__sendsettings__send-type-scheduled__date").attr("required","required"),s.removeClass("unselected"),t.addClass("unselected"),n.attr("value","true")}else{if("acym__campaign__sendsettings__send-type--sheduled"==e(this).attr("id"))return;_.show(),c.hide(),e("#acym__campaign__sendsettings__send-type-scheduled__date").removeAttr("required"),s.addClass("unselected"),t.removeClass("unselected"),n.attr("value","false"),e("#acym__campaign__sendsettings__send-type-scheduled__date").val("")}}),e(".acym__campaign__sendsettings__suggest--choose").off("click").on("click",function(){e(".acym__campaign__sendsettings__send-type--sheduled").hasClass("unselected")&&(e(".acym__campaign__sendsettings__display-send-type-now").hide(),e(".acym__campaign__sendsettings__display-send-type-scheduled").show(),e(".acym__campaign__sendsettings__send-type--sheduled").removeClass("unselected"),e(".acym__campaign__sendsettings__send-type--now").addClass("unselected"),e("#acym__campaign__sendsettings__isScheduled").attr("value","true")),e("#acym__campaign__sendsettings__send-type-scheduled__date").attr("value",e(".acym__campaign__sendsettings__suggest__date").html())}),e("#acym__campaign__choose__campaign").val()&&0!=e("#acym__campaign__choose__campaign").val()&&(e(".acym__templates__oneTpl a").off("click").on("click",function(e){confirm("Are you sure you want to replace your current template with this one ?")||e.preventDefault()}),e(".acym__templates__newTpl a").off("click").on("click",function(e){confirm("Are you sure you want to replace your current template with a empty one ?")||e.preventDefault()})),e(".acym__templates__choose__ribbon").off("click").on("click",function(){var a=e(this).prev();window.location.href=a.attr("href")}),e(".acym__templates__pic").on("click",function(){window.location.href=e(this).find("a").attr("href")}),function(){if(e(".acym__form__campaign__edit").length>0){var a=!1;e('button[data-task="save"], button[data-task="addQueue"], button[data-task="saveAsDraftCampaign"],button[data-task="confirmCampaign"], li[data-task="edit"], [data-task="test"]').on("click",function(){a=!0}),e(window).on("beforeunload",function(t){if(!a)return e("#formSubmit").attr("disabled",!1),""})}}(),e("#acym__campaigns__attach__add").off("click").on("click",function(){i>9||(e("#acym__campaigns__attach__"+i).css("display",""),i++)}),e(".acym__campaigns__attach__remove").off("click").on("click",function(a){var t=a.currentTarget.getAttribute("data-id");e("#attachments"+t+"selection").html(""),e("#attachments"+t+"suppr").css("display","none"),e("#attachments"+t).val("")}),e(".acym__campaigns__attach__delete").off("click").on("click",function(a){var t=e(".acym__campaigns__attach__delete"),s=e(this),_="",c="";t.each(function(a){e(this).attr("data-id")==s.attr("data-id")&&(_=a,c=s.attr("data-id"))});var n=s.attr("data-mail");e.get(AJAX_URL_ACYM+"&ctrl=campaigns&task=deleteAttach&id="+_+"&mail="+n,function(a){"error"==a?console.log("error deleting"):(console.log("success"),e("#acym__campaigns__attach__del"+c).remove())}).fail(function(e){console.log(e)})}),(a=e("#acym__test__field")).select2({width:"100%",placeholder:a.attr("placeholder"),tags:!0,tokenSeparators:[" ",",",";"],createTag:function(a){var t=e.trim(a.term);return null===t.match(ACYM_REGEX_EMAIL)?null:{id:t,text:t}}}),e("#launch_spamtest").off("click").on("click",function(){if(e(this).hasClass("acym_icon_disabled"))return!1;e(this).addClass("acym_icon_disabled"),e("#stop_spamtest").removeClass("acym_icon_disabled"),e(".acym_icon_container").find("i").removeClass().html("").addClass("fa fa-circle-o-notch fa-spin"),e(".acym_check_results").hide().html(""),e("#safe_check_results").removeClass("is-hidden"),m("Content","check_words","checkContent"),m("Links","check_links","checkLinks"),m("SPAM","check_spam","checkSPAM")}),e("#stop_spamtest").off("click").on("click",function(){if(e(this).hasClass("acym_icon_disabled"))return!1;for(var a in e(this).addClass("acym_icon_disabled"),d)d.hasOwnProperty(a)&&d[a]&&4!=d[a].readyState&&d[a].abort();e(".acym_icon_container").find("i.fa-circle-o-notch").removeClass("fa-circle-o-notch fa-spin").addClass("fa-question-circle-o"),o=0,e("#launch_spamtest").removeClass("acym_icon_disabled")}),e("#acym__campaigns__listing__show__action").off("change").on("change",function(){e(".acym__campaign__listing__status__controls").toggle()}),e(".campaigns_edit_email").length>0?(e.introContent=[{element:"#dtext_subject_button",text:ACYM_JS_TXT.ACYM_INTRO_ADD_DTEXT,position:"right"}],e.setIntrojs("campaigns_edit_email")):e(".campaigns_tests").length>0&&(e.introContent=[{element:"#spam_test_zone",text:ACYM_JS_TXT.ACYM_INTRO_SAFE_CHECK,position:"right"}],e.setIntrojs("campaigns_tests")),e("#acym__campaign__send-test").off("click").on("click",function(){e("#acym__campaigns__send-test__spinner").show();var a=e(this);a.attr("disabled","true");var t=AJAX_URL_ACYM+"&page=acymailing_campaigns&ctrl=campaigns&task=test&id="+e('input[name="id"]').val()+"&test_emails="+e("#acym__test__field").val().join(",");e.post(t,function(t){a.removeAttr("disabled"),e("#acym__campaigns__send-test__spinner").hide(),t=JSON.parse(t),e.acym_add_notification(t.message,t.type,t.timer)})});var d=[],o=0;function m(a,t,s){var _=e('input[name="id"]').val(),c=e("#"+t).removeClass("acym_clickable").off("click"),n=c.find(".acym_icon_container i");d[a]=e.ajax({url:AJAX_URL_ACYM+"&ctrl=campaigns&task="+s+"&id="+_,success:function(t){if("SPAM"==a){var s=e.parseJSON(t);if("success"==s.type){c.next(".acym_check_results").html(ACYM_JS_TXT.ACYM_TESTS_SPAM_SENT).show();var _=0,i=setInterval(function(){_++,e.getJSON(s.message+"&format=json",function(a){0!=a.status?(clearInterval(i),c.next(".acym_check_results").hide(),a.mark>-2?n.removeClass().addClass("material-icons acym_icon_green").html("check_circle"):n.removeClass().addClass("material-icons acym_icon_red").html("error"),c.attr("data-open")||c.attr("data-open",c.attr("data-iframe")),c.addClass("acym_clickable").attr("data-iframe",s.message+"&lang="+s.lang),e.Modal()):_>5&&(c.next(".acym_check_results").html(a.title),c.addClass("acym_clickable").on("click",function(){e(this).next(".acym_check_results").slideToggle()}),n.removeClass().addClass("material-icons acym_icon_red").html("error"),clearInterval(i))})},5e3)}else c.next(".acym_check_results").html(s.message),c.addClass("acym_clickable").on("click",function(){e(this).next(".acym_check_results").slideToggle()}),n.removeClass().addClass("material-icons acym_icon_red").html("error")}else t?(n.removeClass().addClass("material-icons acym_icon_red").html("error"),c.addClass("acym_clickable").on("click",function(){e(this).next(".acym_check_results").slideToggle()}),c.next(".acym_check_results").html(t)):n.removeClass().addClass("material-icons acym_icon_green").html("check_circle");3==++o&&(o=0,e("#stop_spamtest").addClass("acym_icon_disabled"),e("#launch_spamtest").removeClass("acym_icon_disabled"))}})}});