function readyFunction(e){Vue.use(infiniteScroll);let t=0,i=[],s=[],l=0,a={available:20,selected:20};const n=(e,t,i)=>e.filter(e=>-1!==i.map(i=>-1!==e[i].toLowerCase().indexOf(t.toLowerCase())).indexOf(!0)),c=(e,t)=>e.filter(e=>e.id!==t),o=(e,t)=>e.filter(e=>e.id===t),h=e=>e.map(e=>parseInt(e.id));if(null!==document.getElementById("acym__entity_select")){new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__entity_select",data:{tableJoin:"",entitiesUnselected:[],data:{},columnJoin:"",offsetBase:5e3,entity:"",displaySelected:!0,loading:!0,entitiesToDisplay_available:[],columnsToDisplay:[],entitiesToDisplay_selected:[],entitiesAvailable:[],entitiesSelected:[],join:"",busy:!1,availableSearch:"",selectedSearch:"",displaySelectAll_available:!0,displaySelectAll_selected:!0,columnsClasses:[]},mounted:function(){let i=document.getElementById("acym__entity_select");i.style.display="flex",this.entity=i.getAttribute("data-entity"),this.columnsToDisplay=i.getAttribute("data-columns").split(","),this.columnsClasses=JSON.parse(i.getAttribute("data-columns-class")),this.join=i.getAttribute("data-join"),this.displaySelected="true"===i.getAttribute("data-display-selected"),this.columnJoin=i.getAttribute("data-column-join"),this.tableJoin=i.getAttribute("data-table-join"),this.data=JSON.parse(document.getElementById("acym__entity_select__data").value),this.handleEntities(this.data.elements),this.data.total<500?this.loading=!1:(t+=500,this.getAllEntities(this.entity)),e(window).off("refreshEntitySelect").on("refreshEntitySelect",function(){readyFunction(e)})},methods:{getClass(e){return"string"==typeof this.columnsClasses[e]?this.columnsClasses[e]:"auto"},selectEntity(e){let t=o(this.entitiesToDisplay_available,e)[0];this.entitiesToDisplay_selected.push(t),this.entitiesSelected.push(t),this.entitiesToDisplay_available=c(this.entitiesToDisplay_available,e),this.entitiesAvailable=c(this.entitiesAvailable,e),this.entitiesUnselected=c(this.entitiesUnselected,e)},unselectEntity(e){let t=o(this.entitiesToDisplay_selected,e)[0];this.entitiesToDisplay_available.push(t),this.entitiesUnselected.push(t),this.entitiesAvailable.push(t),this.entitiesToDisplay_selected=c(this.entitiesToDisplay_selected,e),this.entitiesSelected=c(this.entitiesSelected,e)},loadMoreEntity(e){a[e]+=20;let t="entitiesToDisplay_"+e,i="entities"+e.charAt(0).toUpperCase()+e.slice(1);this[t]=""===this[e+"Search"]?this[i].slice(0,a[e]):n(this["entities"+e.charAt(0).toUpperCase()+e.slice(1)],this[e+"Search"],this.columnsToDisplay)},loadMoreEntityAvailable(){this.loadMoreEntity("available")},loadMoreEntitySelected(){this.loadMoreEntity("selected")},moveAll(e){"available"===e?(this.entitiesSelected=this.entitiesSelected.concat(this.entitiesAvailable),this.entitiesAvailable=[],this.entitiesToDisplay_available=[],this.entitiesToDisplay_selected=this.entitiesSelected.slice(0,a.selected)):(this.entitiesAvailable=this.entitiesAvailable.concat(this.entitiesSelected),this.entitiesUnselected=this.entitiesUnselected.concat(this.entitiesSelected),this.entitiesSelected=[],this.entitiesToDisplay_available=this.entitiesAvailable.slice(0,a.available),this.entitiesToDisplay_selected=[])},doSearch(e){""===this[e+"Search"]?(this["displaySelectAll_"+e]=!0,a[e]=20,this["entitiesToDisplay_"+e]=this["entities"+e.charAt(0).toUpperCase()+e.slice(1)].slice(0,a[e])):(this["displaySelectAll_"+e]=!1,this["entitiesToDisplay_"+e]=n(this["entities"+e.charAt(0).toUpperCase()+e.slice(1)],this[e+"Search"],this.columnsToDisplay))},handleEntities(e){i=i.concat(e);let t=[];null!==this.columnJoin&&(t=((e,t)=>e.filter(e=>null!==e[t]))(e,this.columnJoin),s=s.concat(t)),this.entitiesAvailable=this.entitiesAvailable.concat(((e,t)=>e.filter(e=>-1===JSON.stringify(t).indexOf(JSON.stringify(e))))(e,t)),this.entitiesToDisplay_available.length<1&&(this.entitiesToDisplay_available=this.entitiesAvailable.slice(0,a.available)),this.displaySelected&&null!==this.columnJoin&&(this.entitiesSelected=this.entitiesSelected.concat(t),this.entitiesToDisplay_selected.length<1&&(this.entitiesToDisplay_selected=this.entitiesSelected.slice(0,a.selected)))},getAllEntities(i){let s="";void 0!==this.tableJoin&&void 0!==this.columnJoin&&(s="&join_table="+this.tableJoin+"."+this.columnJoin);let a=ACYM_IS_ADMIN?"entitySelect":"frontentityselect";e.get(ACYM_AJAX_URL+"&ctrl="+a+"&task=loadEntityFront&offset="+t+"&perCalls=500&entity="+i+"&join="+this.join+"&columns="+this.columnsToDisplay.join(",")+s,e=>void 0!==(e=acym_helper.parseJson(e)).error?(console.log(e.error),!1):(l=e.data.total,"end"===e.data?(this.loading=!1,!0):(this.handleEntities(e.data.elements),t>l?(this.loading=!1,!0):(t+=500,this.getAllEntities(i),!0))))},finalLoad(){this.loading=!1,this.loadMoreEntity("available"),this.loadMoreEntity("selected");let t=document.getElementById("acym__entity_select__button__submit");void 0!==t&&null!=t&&t.classList.contains("acy_button_submit")&&acym_helper.setSubmitButtonGlobal(),e(".acym__entity_select__button__close").off("click").on("click",function(){e(this).closest(".reveal").foundation("close")}),acym_helperImport.setVerificationGenericImport(),acym_helperImport.setImportCMSLists(),acym_helperImport.setCreateListFromImportPage()}},watch:{availableSearch:function(){this.doSearch("available")},selectedSearch:function(){this.doSearch("selected")},entitiesSelected(){let t=h(this.entitiesSelected);document.querySelector('[name="acym__entity_select__selected"]').value=JSON.stringify(t);let i=document.querySelector(".acym__campaign__recipients__number-recipients");void 0!==i&&null!=i&&function(t){let i=ACYM_AJAX_URL+"&page=acymailing_campaigns&ctrl="+acym_helper.ctrlCampaigns+"&task=countNumberOfRecipients";e.ajax({url:i,type:"POST",data:{listsSelected:t},beforeSend:function(){e(".acym__campaign__recipients__number-recipients").hide(),e(".acym_loader_logo").show()}}).done(function(t){e(".acym__campaign__recipients__number-recipients").html(t).show(),e(".acym_loader_logo").hide()}).error(function(){e(".acym__campaign__recipients__number-recipients").html(0)})}(t)},entitiesUnselected(){document.querySelector('[name="acym__entity_select__unselected"]').value=JSON.stringify(h(this.entitiesUnselected))},loading(e){e||this.finalLoad()}}})}}jQuery(document).ready(readyFunction);