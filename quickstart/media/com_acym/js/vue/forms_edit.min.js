jQuery(document).ready(function(e){let t;new Vue({el:"#acym__forms",data:()=>({form:acym_helper.parseJson(e("#acym__form__structure").val()),menuActive:"settings",loading:!0,noReloading:["name","pages","active","delay"],oldForm:{}}),mounted(){this.oldForm=Object.assign({},this.form),e("#acym__forms__preview__content").on("load",()=>{this.getFormRender(),this.disableClickIframe()}),acym_helperSwitch.setSwitchFieldsGlobal()},computed:{isMenuSettingsActive(){return"settings"===this.menuActive},imageText(){return ACYM_JS_TXT[""===this.form.image_options.url?"ACYM_SELECT":"ACYM_CHANGE"]}},methods:{changeMenuActive(e){this.menuActive=e},selectPosition(e){this.form.style_options.position=e},save(t){if(""===this.form.name)return void alert(ACYM_JS_TXT.ACYM_PLEASE_FILL_FORM_NAME);this.loading=!0,this.form.active=e('[name="form[active]"]').val();let i=ACYM_AJAX_URL+"&ctrl=forms&task=saveAjax";return e.ajax({type:"POST",url:i,dataType:"json",data:{form:this.form}}).then(i=>{if(this.loading=!1,void 0!==i.error)return acym_helperNotification.addNotification(i.error,"error"),!1;t?window.location.href=e("#acym_form").attr("action")+"&task=listing":(acym_helperNotification.addNotification(i.message,"info",!0),this.form.id=i.id,e("#acym__form__structure").val(i.id))})},disableClickIframe(){let t=e("#acym__forms__preview__content");t.contents().find("#acym__forms__edit_live__preview").remove(),t.contents().find("body").prepend("<style>\n                                * {pointer-events: none !important;}\n                            </style>")},fillIframe(t){let i=e("#acym__forms__preview__content");t=`<div id="acym__forms__edit_live__preview">${t}</div>`,i.contents().find("#acym__forms__edit_live__preview").remove(),i.contents().find("body").prepend(t)},getFormRender(){this.loading=!0;let t=ACYM_AJAX_URL+"&ctrl=forms&task=updateFormPreview";return e.ajax({type:"POST",url:t,dataType:"json",data:{form:this.form}}).then(e=>{if(this.loading=!1,void 0!==e.error)return acym_helperNotification.addNotification(e.error,"error"),!1;this.fillIframe(e.html)})}},watch:{form:{handler(){clearTimeout(t);for(let e=0;e<this.noReloading.length;e++)if(this.form[this.noReloading[e]]!==this.oldForm[this.noReloading[e]])return void(this.oldForm=Object.assign({},this.form));this.loading=!0,this.oldForm=Object.assign({},this.form),t=setTimeout(()=>{this.getFormRender()},1e3)},deep:!0}}})});