jQuery(document).ready(function(i){if(i("#acym__plugin__available__application").length>0){new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__plugin__available__application",data:{allPlugins:[],displayedPlugins:[1],search:"",type:"",level:"",loading:!0,typesColors:{"Files management":"background-color: #C5EAFF;","E-commerce solutions":"background-color: #E7CEFF;","Content management":"background-color: #FFC1E9;","Subscription system":"background-color: #FFC7C7;",Others:"background-color: #FFF1BC;","User management":"background-color: #CAFFBA;","Events management":"background-color: #C2FFF9;"},noPluginTodisplay:!1,typingTimer:"",doneTypingInterval:1e3,currentLevel:"",downloading:{},allPluginsInstalled:{},pageDisplay:1,busy:!1,installed:{}},mounted:function(){this.getAllPlugins().then(e=>{if(void 0!==(e=acym_helper.parseJson(e)).error)return acym_helperNotification.addNotification(e.error,"error"),!1;acym_helperBack.config_get("level").done(l=>{if(void 0!==l.error)return acym_helperNotification.addNotification(l.error,"error"),!1;this.getAllPluginsInstalled().then(t=>{this.allPluginsInstalled=t.elements,this.currentLevel=l.data.toLowerCase(),this.allPlugins=e,e=e.map(i=>{i.description=i.description.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br />")}),this.setStatus(),this.resetDisplay(),i('[name="acym__plugins__level"], [name="acym__plugins__type"]').select2({theme:"foundation",width:"100%"}),0===this.displayedPlugins.length&&(this.noPluginTodisplay=!0),this.loading=!1,setTimeout(()=>{this.$forceUpdate(),acym_helperTooltip.setTooltip()},400)})})})},methods:{getAllPlugins(){let e=AJAX_URL_UPDATEME+"integrationv6&task=getAllPlugin&cms="+CMS_ACYM;return i.post(e)},getAllPluginsInstalled(){let e=ACYM_AJAX_URL+"&ctrl=plugins&task=getAllPluginsAjax";return i.ajax({type:"POST",url:e,dataType:"json"})},download(e){if(this.downloading[e.id])return!0;this.downloading[e.id]=!0,this.downloading={...this.downloading};let l=ACYM_AJAX_URL+"&ctrl=plugins&task=download";i.ajax({url:l,type:"POST",data:{plugin:e}}).then(i=>{if(void 0!==(i=acym_helper.parseJson(i)).error)return acym_helperNotification.addNotification(i.error,"error"),this.downloading[e.id]=!1,this.downloading={...this.downloading},!1;acym_helperNotification.addNotification(i.message,"info"),this.downloading[e.id]=!1,this.installed[e.id]=!0})},resetDisplay(){this.pageDisplay=1,this.fillDisplayPlugins()},fillDisplayPlugins(){this.displayedPlugins=this.filter().slice(0,18*this.pageDisplay),this.displayedPlugins=[...this.displayedPlugins]},rightLevel(i){return"starter"===i||("essential"===i&&-1!==["essential","enterprise"].indexOf(this.currentLevel)||"enterprise"===i&&"enterprise"===this.currentLevel)},ucfirst:i=>void 0===i?"":i.charAt(0).toUpperCase()+i.slice(1),setStatus(){for(let i in this.allPlugins)this.downloading[this.allPlugins[i].id]=!1,this.installed[this.allPlugins[i].id]=this.isInstalled(this.allPlugins[i].name)},isInstalled(i){return void 0!==this.allPluginsInstalled.find(e=>e.title==i)},filter(){return this.allPlugins.filter(i=>-1!==i.level.toLowerCase().indexOf(this.level.toLowerCase())&&-1!==i.category.toLowerCase().indexOf(this.type.toLowerCase())&&-1!==i.name.toLowerCase().indexOf(this.search.toLowerCase()))},handlePluginsInstalled(i){return void 0===this.allPluginsInstalled?i:i.filter(i=>-1===this.allPluginsInstalled.map(e=>i.file_name.replace(".zip","")===e.folder_name).indexOf(!0))},loadMorePlugins(){this.pageDisplay++,this.fillDisplayPlugins()},imageUrl:i=>(void 0!==i&&(i=i.substring(0,i.indexOf("."))),AJAX_URL_UPDATEME+"integrationv6&task=getImage&plugin="+i),documentationUrl:i=>void 0===i?"":(i=i.replace(".zip",""),AJAX_URL_UPDATEME+"integrationv6&task=getDocumentation&plugin="+i),isOverflown(i){return void 0===this.$refs.plugins||void 0===this.$refs.plugins[i]?"":this.$refs.plugins[i].scrollHeight>this.$refs.plugins[i].clientHeight?"acym__plugins__card__params_desc__overflown":""}},watch:{displayedPlugins(i,e){this.noPluginTodisplay=0===this.displayedPlugins.length&&1!==e[0]},search(i){clearTimeout(this.typingTimer),""===i?this.resetDisplay():this.typingTimer=setTimeout(()=>{this.resetDisplay()},this.doneTypingInterval)},type(){this.resetDisplay()},level(){this.resetDisplay()}}})}});