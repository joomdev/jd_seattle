jQuery(document).ready(function(e){if(e("#requireConfirmation").length>0){let s=20,i=s,t=500;const r=["email","name"],c=(e,s,i)=>e.filter(e=>-1!==i.map(i=>-1!==e[i].toLowerCase().indexOf(s.toLowerCase())).indexOf(!0));new Vue({directives:{infiniteScroll:infiniteScroll},el:"#acym__list__settings__subscribers",data:{subscribed:[],displayedSubscribers:[],busy:!1,listid:0,total:0,loading:!0,searchSubscribers:"",requireConfirmation:0},mounted:function(){document.querySelector(".acym__list__settings__subscribers__search input.acym__light__input").addEventListener("keydown",function(e){if(13==e.keyCode)return e.preventDefault(),!1}),this.requireConfirmation=document.getElementById("requireConfirmation").value;let e=document.getElementById("acym__list__settings__subscribers__listing");null!==e&&(e.style.display="flex"),this.subscribed=JSON.parse(document.getElementById("subscribers_subscribed").value),this.listid=document.querySelector('[name="id"]').value,this.total=this.subscribed.length,this.displayedSubscribers=this.subscribed.slice(0,i),this.total<t?this.loading=!1:this.getAllSubscribers()},methods:{loadMoreSubscriber(){i+=s,this.displayedSubscribers=""===this.searchSubscribers?this.subscribed.slice(0,i):c(this.subscribed,this.searchSubscribers,r)},getAllSubscribers(){let s=document.querySelector('[name="ctrl"]').value;e.get(ACYM_AJAX_URL+"&ctrl="+s+"&task=loadMoreSubscribers&offset="+this.total+"&perCalls="+t+"&listid="+this.listid,e=>{if(void 0!==(e=JSON.parse(e)).error)return console.log(e.error),!1;if(0===e.data.length)return this.loading=!1,!0;let s=e.data.length;return this.subscribed=this.subscribed.concat(e.data),this.total+=s,s<t?(this.loading=!1,!0):(this.getAllSubscribers(),!0)})},doSearch(){""===this.searchSubscribers?(i=s,this.displayedSubscribers=this.subscribed.slice(0,i)):this.displayedSubscribers=c(this.subscribed,this.searchSubscribers,r)},unsubscribeUser(s){let i=e("#acym_form");e('[name="acym__entity_select__selected"]').val(""),e('[name="acym__entity_select__unselected"]').val("["+s+"]"),i.find('[name="task"]').attr("value","saveSubscribers"),i.submit()}},watch:{searchSubscribers(){this.doSearch()}}})}});