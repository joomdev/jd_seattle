/**
 * @package    AcyMailing for Joomla
 * @version    6.2.2
 * @author     acyba.com
 * @copyright  (C) 2009-2019 ACYBA S.A.R.L. All rights reserved.
 * @license    GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html
 */

jQuery(document).ready(function(_){var a,e,t,i,s,c,r,l=0,m=0,o=0,h=0,n=500,u=10,g=0,d=0,y=0;function f(){var a=_("#acym__migrate__mails").is(":checked");a?_("#acym__migrate__input__global_stats").show():_("#acym__migrate__input__global_stats").hide(),_("#acym__migrate__mailstats").prop("disabled",0==a),_("#acym__migrate__button").prop("disabled",0==_("input:checked").length)}function k(){_("#acym__migrate__no__button").prop("disabled",!0),_("#acym__migrate__button").prop("disabled",!0),_(".acym__migrate__option").prop("disabled",!0);var a={config:_("#acym__migrate__config").is(":checked")&&!_("#acym__migrate__config").hasClass("acym__migrate__migrate_with_success_element"),bounce:_("#acym__migrate__bounce").is(":checked")&&!_("#acym__migrate__bounce").hasClass("acym__migrate__migrate_with_success_element"),lists:_("#acym__migrate__lists").is(":checked")&&!_("#acym__migrate__lists").hasClass("acym__migrate__migrate_with_success_element"),mails:_("#acym__migrate__mails").is(":checked")&&!_("#acym__migrate__mails").hasClass("acym__migrate__migrate_with_success_element"),templates:_("#acym__migrate__templates").is(":checked")&&!_("#acym__migrate__templates").hasClass("acym__migrate__migrate_with_success_element"),fields:_("#acym__migrate__fields").is(":checked")&&!_("#acym__migrate__fields").hasClass("acym__migrate__migrate_with_success_element"),users:_("#acym__migrate__users").is(":checked")&&!_("#acym__migrate__users").hasClass("acym__migrate__migrate_with_success_element")};a.subscriptions=a.users&&a.lists,a.users_fields=a.users&&a.fields,a.mailstats=_("#acym__migrate__mailstats").is(":checked")&&!_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),a.mailhaslists=a.mails&&a.lists,a.welcomeunsub=a.mails&&a.lists;var e=[],t=[];a.mails,_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),a.mails&&a.lists,a.lists;_.each(a,function(_,a){if(!0===a){var i=AJAX_URL_ACYM+"&ctrl=dashboard&task=preMigration&element="+_;e.push(i),t.push(_)}}),_("#acym__migrate__all_checked_elements").val(JSON.stringify(t)),g=t.length,d=100/g,_(".acym__migration__need__display").show(),p(e,t)}function w(a,e,t,i,s){a?(_("#acym__migrate__error_element").val(e),_("#acym__migrate__result__"+e+"__check").html('<i class="fa fa-exclamation-circle acym__color__red"></i>'),"mails"==e&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="fa fa-exclamation-circle acym__color__red"></i>'),_("#acym__migrate__result__error__message").html(s),_("#acym__migrate__result__error").show()):(_("#acym__migrate__result__"+e+"__check").html('<i class="fa fa-check-circle acym__color__green"></i>'),"mails"==e&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="fa fa-check-circle acym__color__green"></i>'),_("#acym__migrate__"+e).addClass("acym__migrate__migrate_with_success_element"),p(t,i))}function p(a,e){if(0==a.length)return _("#acym__migration__progress__bar__inner").animate({width:"100%"}),_("#acym__migration__percentage").html("100%"),void _("#acym__migrate__result__ok").show();var t=e.shift().toLowerCase();_("#acym__migrate__result__"+t+"__check").html('<i class="fa fa-circle-o-notch fa-spin acym__color__blue"></i>');var i=a.shift();_.post(i,function(i){if("0"==i)y+=d,_("#acym__migration__progress__bar__inner").animate({width:Math.round(y)+"%"}),_("#acym__migration__percentage").html(Math.round(y)+"%"),w(!1,t,a,e,i);else if(-1!==i.indexOf("ERROR"))w(!0,t,a,e,i);else{m=0,h=0,l=Math.ceil(i/(n*u)),o=Math.ceil(i/n);!function a(e,t,i){for(var s=!1,c=[],r="",g=0;g<u&&!(h>o);g++){var f=h*n,k=_.post(AJAX_URL_ACYM+"&ctrl=dashboard&task=migrate&element="+e+"&currentElement="+f+"&insertPerCalls="+n);c.push(k),h++}return _.when.apply(_,c).then(function(){m++,y=d/l+y,_("#acym__migration__progress__bar__inner").animate({width:Math.round(y)+"%"}),_("#acym__migration__percentage").html(Math.round(y)+"%"),_.each(arguments,function(_,a){-1!==a[0].indexOf("ERROR")&&(s=!0,r=a[0],w(s,e,t,i,r))}),m===l?w(s,e,t,i,r):a(e,t,i)}),!0}(t,a,e)}}).fail(function(a){_("#acym__migrate__result").append("<br>"+ACYM_JS_TXT.ACYM_LOADING_ERROR)})}function v(){_(".acym__walkthrough__list__receivers__remove").off("click").on("click",function(){_(this).closest("tr").remove()})}_(".acym__walk-through__select").select2({theme:"foundation",width:"100%"}),function a(){_(".acym__dashboard__active-campaings__one-campaing__action").off("click").on("click",function(){var e=AJAX_URL_ACYM+"&ctrl=campaigns&task=cancelDashboardAndGetCampaignsAjax&id="+_(this).attr("id");_.post(e,function(e){"error"==e?console.log(e):_(".acym__dashboard__active-campaings__listing").html(e),a()})})}(),_("#acym__walk-through-1__content__toggle-reply-to__checkbox").off("change").on("change",function(){_(".acym__walk-through-1__content__reply-to").toggle()}),a=_(".acym__walk-through-2__choose_your-server"),e=_(".acym__walk-through-2__choose_external-server"),t=_(".acym__walk-through-2__smtp-server"),i=_(".acym__walk-through-2__elastic-email"),s=_(".acym__walk-through-2__toggle-mail .acym__walk_through_toggle-span"),c=_(".acym__walk-through-2__choose_external-server .acym__walk_through_toggle-span"),s.off("click").on("click",function(){s.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"your-server"==_(this).attr("id")?a.show()&&e.hide()&&_("#acym__walk-through-2__way-mail").val(_(".your_server_selected").attr("id")):a.hide()&&e.show()&&_("#acym__walk-through-2__way-mail").val(_(".acym__walk-through-2__choose_external-server .walk-through_selected").attr("id"))}),c.off("click").on("click",function(){c.removeClass("walk-through_selected"),_(this).addClass("walk-through_selected"),"smtp"==_(this).attr("id")?t.show()&&i.hide():t.hide()&&i.show(),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),(r=_(".acym__walk-through-2__button")).off("click").on("click",function(a){a.preventDefault(),r.addClass("unselected").removeClass("your_server_selected"),_(this).removeClass("unselected").addClass("your_server_selected"),_("#acym__walk-through-2__way-mail").attr("value",_(this).attr("id"))}),_(".acym__migrate__option").off("change").on("change",function(){f(),_(".acym__migrate__option:disabled").prop("checked",!1)}),f(),_("#acym__migrate__button").off("click").on("click",function(){k()}),_("#acym__migrate__restart_from_error__button").off("click").on("click",function(){window.scrollTo(0,0),_("#acym__migrate__result__error").hide(),_("#acym__migrate__result__error__message").html(""),k()}),_("#available_ports_check").off("click").on("click",function(a){a.preventDefault();var e=_(this).parent();e.html('<i class="fa fa-circle-o-notch fa-spin"></i>'),_.get(AJAX_URL_ACYM+"&ctrl=configuration&task=ports",function(_){e.html(_)})}),_("#acym__subscribe__news").on("click",function(){var a=_('input[type="email"]').val();if(!_.acym_emailValid(a))return alert(ACYM_JS_TXT.email),!1;_(this).attr("disabled","true");var e=AJAX_URL_ACYBA+"index.php?option=com_updateme&ctrl=subscription&task=subscribe&email="+a+"&cms="+CMS_ACYM;_.get(e),_(".acy_button_submit").click()}),v(),_("#acym__walkthrough__list__new").on("click",function(){_(this).hide(),_("#acym__walkthrough__list__add-zone").show()}),_("#acym__walkthrough__list__add").on("click",function(){var a=_("#acym__walkthrough__list__new-address"),e=a.val();if(!_.acym_emailValid(e))return alert(ACYM_JS_TXT.email),!1;var t='<input type="hidden" name="addresses[]" value="'+e+'"/>'+e;_("#acym__walkthrough__list__receivers").append("<tr><td>"+t+'</td><td><i class="fa fa-remove acym__walkthrough__list__receivers__remove"></i></td></tr>'),a.val(""),_("#acym__walkthrough__list__add-zone").hide(),_("#acym__walkthrough__list__new").show(),v()}),_("#acym__walkthrough__list__new-address").on("keypress",function(a){if(13===a.which)return _("#acym__walkthrough__list__add").click(),!1}),_("#acym__walkthrough__skip__fail").off("click").on("click",function(){_("[required]").removeAttr("required"),_('[type="email"]').attr("type","text"),_("#acym__walkthrough__skip").click()}),_(".acym__walkthrough__fail__choice").off("click").on("click",function(){var a=_(".acym__walkthrough__fail__"+_(this).attr("data-show"));if(a.is(":visible"))return!0;_(".selected").removeClass("selected"),_(this).addClass("selected"),_(".acym__walkthrough__fail__toggle-div").hide(),a.show(),_('[name="choice"]').val(_(this).attr("data-show")),_(".acym__walkthrough__fail__contact").is(":visible")?_('[name="email"]').attr("required","true"):_('[name="email"]').removeAttr("required")}),_(".acym__walkthrough__result__choice__one").off("click").on("click",function(){if(_(this).hasClass("selected"))return!0;_(".acym__walkthrough__result__choice__one").removeClass("selected"),_(this).addClass("selected"),"acym__walkthrough__result__choice__no"===_(this).attr("id")?_("#acym__walkthrough__result__spam").addClass("visible"):_("#acym__walkthrough__result__spam").removeClass("visible"),_('input[name="result"]').val(_(this).attr("data-value")),_('[data-task="saveStepResult"]').attr("disabled",!1)}),_(".acym__walkthrough__fail__gmail input").off("keypress").on("keypress",function(_){if(13==_.keyCode)return _.preventDefault(),!1}),_.walkthroughList=function(){return 0!==_(".acym__walkthrough__list__receivers__remove").length||(alert(ACYM_JS_TXT.ACYM_AT_LEAST_ONE_USER),!1)}});