jQuery(document).ready(function(_){let e=0,a=0,t=0,i=0,c=500,s=10,m=0,r=0,l=0;function n(){let e=_("#acym__migrate__mails").is(":checked");e?_("#acym__migrate__input__global_stats").show():_("#acym__migrate__input__global_stats").hide(),_("#acym__migrate__mailstats").prop("disabled",!1===e),_("#acym__migrate__button").prop("disabled",0===_("input:checked").length)}function o(){_("#acym__migrate__no__button").prop("disabled",!0),_("#acym__migrate__button").prop("disabled",!0),_(".acym__migrate__option").prop("disabled",!0);let e={config:_("#acym__migrate__config").is(":checked")&&!_("#acym__migrate__config").hasClass("acym__migrate__migrate_with_success_element"),bounce:_("#acym__migrate__bounce").is(":checked")&&!_("#acym__migrate__bounce").hasClass("acym__migrate__migrate_with_success_element"),lists:_("#acym__migrate__lists").is(":checked")&&!_("#acym__migrate__lists").hasClass("acym__migrate__migrate_with_success_element"),mails:_("#acym__migrate__mails").is(":checked")&&!_("#acym__migrate__mails").hasClass("acym__migrate__migrate_with_success_element"),templates:_("#acym__migrate__templates").is(":checked")&&!_("#acym__migrate__templates").hasClass("acym__migrate__migrate_with_success_element"),fields:_("#acym__migrate__fields").is(":checked")&&!_("#acym__migrate__fields").hasClass("acym__migrate__migrate_with_success_element"),users:_("#acym__migrate__users").is(":checked")&&!_("#acym__migrate__users").hasClass("acym__migrate__migrate_with_success_element")};e.subscriptions=e.users&&e.lists,e.users_fields=e.users&&e.fields,e.mailstats=_("#acym__migrate__mailstats").is(":checked")&&!_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),e.mailhaslists=e.mails&&e.lists,e.welcomeunsub=e.mails&&e.lists;let a=[],t=[];e.mails,_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__mailstats").hasClass("acym__migrate__migrate_with_success_element"),e.mails&&e.lists,e.lists;_.each(e,function(_,e){if(!0===e){let e=ACYM_AJAX_URL+"&ctrl=dashboard&task=preMigration&element="+_;a.push(e),t.push(_)}}),_("#acym__migrate__all_checked_elements").val(JSON.stringify(t)),m=t.length,r=100/m,_(".acym__migration__need__display").show(),g(a,t)}function g(m,n){if(0===m.length)return _("#acym__migration__progress__bar__inner").animate({width:"100%"}),_("#acym__migration__percentage").html("100%"),void _("#acym__migrate__result__ok").show();let o=n.shift().toLowerCase();_("#acym__migrate__result__"+o+"__check").html('<i class="acymicon-circle-o-notch acymicon-spin acym__color__blue"></i>');let g=m.shift();_.post(g,function(g){if("0"==g)l+=r,_("#acym__migration__progress__bar__inner").animate({width:Math.round(l)+"%"}),_("#acym__migration__percentage").html(Math.round(l)+"%"),h(!1,o,m,n,g);else if(-1!==g.indexOf("ERROR"))h(!0,o,m,n,g);else{a=0,i=0,e=Math.ceil(g/(c*s)),t=Math.ceil(g/c);!function m(n,o,g){let y=!1,u=[],d="";for(let e=0;e<s&&!(i>t);e++){let e=i*c,a=_.post(ACYM_AJAX_URL+"&ctrl=dashboard&task=migrate&element="+n+"&currentElement="+e+"&insertPerCalls="+c);u.push(a),i++}return _.when.apply(_,u).then(function(){a++,l=r/e+l,_("#acym__migration__progress__bar__inner").animate({width:Math.round(l)+"%"}),_("#acym__migration__percentage").html(Math.round(l)+"%"),_.each(arguments,function(_,e){-1!==e[0].indexOf("ERROR")&&(y=!0,d=e[0],h(y,n,o,g,d))}),a===e?h(y,n,o,g,d):m(n,o,g)}),!0}(o,m,n)}}).fail(function(e){_("#acym__migrate__result").append("<br>"+ACYM_JS_TXT.ACYM_LOADING_ERROR)})}function h(e,a,t,i,c){e?(_("#acym__migrate__error_element").val(a),_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),"mails"===a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-exclamation-circle acym__color__red"></i>'),_("#acym__migrate__result__error__message").html(c),_("#acym__migrate__result__error").show()):(_("#acym__migrate__result__"+a+"__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),"mails"===a&&_("#acym__migrate__mailstats").is(":checked")&&_("#acym__migrate__result__mailstats__check").html('<i class="acymicon-check-circle acym__color__green"></i>'),_("#acym__migrate__"+a).addClass("acym__migrate__migrate_with_success_element"),g(t,i))}_(".acym__migrate__option").off("change").on("change",function(){n(),_(".acym__migrate__option:disabled").prop("checked",!1)}),n(),_("#acym__migrate__button").off("click").on("click",function(){o()}),_("#acym__migrate__restart_from_error__button").off("click").on("click",function(){window.scrollTo(0,0),_("#acym__migrate__result__error").hide(),_("#acym__migrate__result__error__message").html(""),o()})});