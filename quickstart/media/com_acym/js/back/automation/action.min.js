jQuery(document).ready(function(a){function t(){1==a("#adminAutomation").val()&&a(document).find('[data-open*="acy_add_queuetime"]').attr("disabled","disabled"),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),function(){let _=a("#acym__automation__actions__json");if(!_.length)return;let e=JSON.parse(_.val());a(".acym__automation__actions__select").off("change.loadoptions").on("change.loadoptions",function(){a(this).parent().parent().find(".acym__automation__inserted__action").remove();let _=e[a(this).val()].option.replace(/__and__/g,a(this).closest(".acym__automation__actions__one__action").attr("data-action-number"));a(this).parent().after('<div class="grid-x acym__automation__inserted__action margin-top-1 margin-left-2 grid-margin-x cell acym_vcenter">'+_+"</div>"),1==a("#adminAutomation").val()&&a(this).parent().next().find('[data-open*="acy_add_queuetime"]').attr("disabled","disabled"),acym_helperSelect2.setSelect2(),a(document).foundation(),a(".reveal-overlay").appendTo("#acym_form"),t();let n=a(this).closest(".acym__automation__actions__one__action").find(".acym__automation__actions__operator__dropdown"),o=a(this).closest(".acym__automation__actions__one__action").find(".acym__automation__actions__fields__dropdown");n.on("change",function(){o.trigger("change")}),o.on("change",function(){let t=a(this).closest(".acym__automation__inserted__action"),_=t.find('[data-action-field="'+a(this).val()+'"]'),e=t.find(".acym__automation__actions__fields__select"),o=t.find(".acym__automation__action__regular-field");_.length>0&&"="===n.val()?(o.attr("name",o.attr("name").replace("acym_action","")).hide(),e.each(function(t){a(this).attr("name",a(this).attr("name").replace("acym_action","")),a(this).closest(".acym__automation__one-field").hide()}),-1===_.attr("name").indexOf("acym_action")&&_.attr("name","acym_action"+_.attr("name")),_.closest(".acym__automation__one-field").show()):(-1===o.attr("name").indexOf("acym_action")&&o.attr("name","acym_action"+o.attr("name")),e.length>0&&e.each(function(){a(this).attr("name",a(this).attr("name").replace("acym_action","")),a(this).closest(".acym__automation__one-field").hide()}),o.show())}),a(this).closest(".acym__automation__actions__one__action").find(".acym__automation__actions__fields__dropdown").trigger("change")})}(),a(".acym__automation__add-action").off("click").on("click",function(){let _=a("#acym__automation__action__number__action");_.val(parseInt(_.val())+1),a(this).before(a("#acym__automation__example").html());let e=a(this).prev();e.closest(".acym__automation__actions__one__action").attr("data-action-number",_.val()),e.find("select").select2({theme:"foundation",width:"100%"}),t()}),a(".acym__automation__delete__one__action").off("click").on("click",function(){a(this).closest(".acym__automation__actions__one__action").remove()}),acym_helper.setSubmitButtonGlobal(),a(".acym__automation__actions__mails__select").on("change",function(){a(this).closest(".acym__automation__inserted__action").find('[data-task="createMail"]').html("0"===a(this).val()?ACYM_JS_TXT.ACYM_CREATE_MAIL:ACYM_JS_TXT.ACYM_EDIT_MAIL)}),acym_helperModal.setResetMail(),acym_helperModal.setTemplateModal(!0)}t(),function(){let _=a("#actions");if(!_.length)return;let e=JSON.parse(_.val()),n=0;a.each(e,function(t,_){n>0&&a(".acym__automation__add-action").click(),a.each(_,function(t,_){let e=a(".acym__automation__actions__select").last();e.val(t),e.trigger("change");let o=Object.keys(_);a.each(o,function(e){let i=o[e],c=_[o[e]],m=a('[name="acym_action[actions]['+n+"]["+t+"]["+i+']"]');a.setFieldValue(m,c),"acy_add_queue"===t&&"mail_id"===i&&""!==c&&(m.next().html(_.mail_name+'<i class="cursor-pointer acymicon-close acym__color__red acym__automation__action__reset__mail margin-left-1"></i>'),m.prev().html(ACYM_JS_TXT.ACYM_EDIT_MAIL)),m.trigger("change")})}),n++}),t()}()});