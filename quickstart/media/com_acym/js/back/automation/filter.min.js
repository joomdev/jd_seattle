jQuery(document).ready(function(t){const a={};function e(a){let e=a.attr("data-filter-number"),_=a.find(".acym__automation__or__total__result"),i=ACYM_AJAX_URL+"&page=acymailing_automation&ctrl=automation&task=countResultsOrTotal&or="+e;_.html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),t.get(i,a.closest("#acym_form").serialize()+"&page=acymailing_automation&ctrl=automation&task=countResultsOrTotal&or="+e).done(function(t){_.html(t)}).fail(function(){_.html(ACYM_JS_TXT.ACYM_ERROR)})}function _(){i("classic"),i("user"),t(".acym__automation__add-filter").off("click").on("click",function(){let a=t(this).closest(".acym__automation__group__filter").find(".acym__automation__one__filter").length;if(0===a){let a=t("#acym__automation__and__example").clone().removeAttr("id");a.find(".acym__automation__and").remove(),t(this).parent().before(a.show())}else t(this).parent().before(t("#acym__automation__and__example").clone().removeAttr("id").show());let e=t(this).parent().prev();e.addClass("acym__automation__one__filter__"+t(this).attr("data-filter-type")),e.find(".acym__automation__and__example__"+t(this).attr("data-filter-type")+"__select").show().find("select").addClass("acym__select").select2({theme:"foundation",width:"100%"}),_()}),t(".acym__automation__choose__filter").off("click").on("click",function(){t("#acym__automation__type-filter__input").val(t(this).attr("data-filter")),t(".selected-filter").removeClass("selected-filter"),t(this).addClass("selected-filter");let a=t(".acym__automation__filter__container");a.hide(),a.find('[name^="acym_action"]').each(function(a){t(this).attr("name",t(this).attr("name").replace("acym_action",""))});let e=t("#acym__automation__filters__type__"+t(this).attr("data-filter"));e.show(),e.find('[name^="[filters]"]').each(function(a){t(this).attr("name","acym_action"+t(this).attr("name"))})}),t(".acym__automation__filters__or").off("click").on("click",function(){let a=t("#acym__automation__filters__count__or");a.val(parseInt(a.val())+1),t(this).before(t("#acym__automation__or__example").html());let i=t(this).prev();i.attr("data-filter-number",a.val()),_(),i.find("button[data-filter-type]").attr("data-filter-type",t(this).attr("data-filter-type")).click(),"classic"===t(this).attr("data-filter-type")&&e(i)}),t(".acym__automation__delete__one__filter").off("click").on("click",function(){let a=t(this).closest(".acym__automation__group__filter");t(this).parent().parent().remove(),e(a)}),t(".acym__automation__delete__group__filter").off("click").on("click",function(){t(this).parent().parent().prev().remove(),t(this).parent().parent().remove()}),acym_helperDatePicker.setDatePickerGlobal(),acym_helperDatePicker.setRSDateChoice(),acym_helperSelect2.setAjaxSelect2(),t.setAutomationReload()}function i(a){let i=t("#acym__automation__filter__"+a+"__options");if(!i.length)return;let o=JSON.parse(i.val());t(".acym__automation__select__"+a+"__filter").off("change").on("change",function(){let i=t("#acym__automation__filters__count__and");i.val(parseInt(i.val())+1),t(this).parent().parent().find(".acym__automation__inserted__filter").remove();let n=o[t(this).val()].replace(/__numor__/g,t(this).closest(".acym__automation__group__filter").attr("data-filter-number"));n=n.replace(/__numand__/g,i.val()),t(this).parent().after('<div data-and="'+i.val()+'" class="cell grid-x grid-margin-x grid-margin-y acym__automation__inserted__filter margin-top-1 margin-left-2"><span class="countresults margin-bottom-1" id="results_'+i.val()+'"></span>'+n+"</div>"),acym_helperSelect2.setSelect2(),acym_helperDatePicker.setDatePickerGlobal(),t(".switch-label").off("click").on("click",function(){let a=t('input[data-switch="'+t(this).attr("for")+'"]');a.attr("value",1-a.attr("value"))});let c=t(this).closest(".acym__automation__one__filter").find(".acym__automation__filters__operator__dropdown"),l=t(this).closest(".acym__automation__one__filter").find(".acym__automation__filters__fields__dropdown");c.on("change",function(){l.trigger("change")}),l.on("change",function(){let a=t(this).closest(".acym__automation__inserted__filter"),e=a.find('[data-filter-field="'+t(this).val()+'"]'),_=a.find(".acym__automation__filters__fields__select"),i=a.find(".acym__automation__filter__regular-field");e.length>0&&("="===c.val()||"!="===c.val())?(i.attr("name",i.attr("name").replace("acym_action","")).hide(),_.each(function(a){t(this).attr("name",t(this).attr("name").replace("acym_action","")),t(this).closest(".acym__automation__one-field").hide()}),-1===e.attr("name").indexOf("acym_action")&&e.attr("name","acym_action"+e.attr("name")),e.closest(".acym__automation__one-field").show()):(-1===i.attr("name").indexOf("acym_action")&&i.attr("name","acym_action"+i.attr("name")),_.length>0&&_.each(function(){t(this).attr("name",t(this).attr("name").replace("acym_action","")),t(this).closest(".acym__automation__one-field").hide()}),i.show())}).trigger("change"),"classic"===a&&(t(this).closest(".acym__automation__one__filter.acym__automation__one__filter__classic").find(".acym__automation__inserted__filter input, .acym__automation__inserted__filter select").on("change",function(){t.reloadCounters(this)}),0==t(this).val()?e(t(this).closest(".acym__automation__group__filter")):t.reloadCounters(t(this).closest(".acym__automation__one__filter.acym__automation__one__filter__classic").find(".acym__automation__inserted__filter input, .acym__automation__inserted__filter select"))),t(document).foundation(),t(".reveal-overlay").appendTo("#acym_form"),_()})}t.reloadCounters=function(_){let i=t(_).closest(".acym__automation__group__filter").attr("data-filter-number"),o=t(_).closest(".acym__automation__group__filter"),n=t(_).closest(".acym__automation__inserted__filter").attr("data-and"),c=ACYM_AJAX_URL+"&page=acymailing_automation&ctrl=automation&task=countresults&or="+i+"&and="+n;void 0!==a[n]&&a[n].abort(),t("#results_"+n).css("maxHeight","18px").html('<i class="acymicon-circle-o-notch acymicon-spin"></i>'),a[n]=t.get(c,t(_).closest("#acym_form").serialize()+"&page=acymailing_automation&ctrl=automation&task=countresults&or="+i+"&and="+n).done(function(a){t("#results_"+n).css("maxHeight","").html(a)}).fail(function(){t("#results_"+n).css("maxHeight","").html(ACYM_JS_TXT.ACYM_ERROR)}),e(o)},e(t(".acym__automation__select__classic__filter").closest(".acym__automation__group__filter")),_(),function(){let a=t("#filters");if(!a.length)return;let e=JSON.parse(a.val()),i=e.type_filter,o=0;t.each(e,function(a,e){let _=0;if("type_filter"===a)return!0;0!==o&&t('.acym__automation__filters__or[data-filter-type="'+i+'"]').click(),t.each(e,function(a,e){0!==_&&t('.acym__automation__group__filter[data-filter-number="'+o+'"]').find('.acym__automation__add-filter[data-filter-type="'+i+'"]').click(),t.each(e,function(a,e){let _=t('.acym__automation__group__filter[data-filter-number="'+o+'"]').find(".acym__automation__select__"+i+"__filter").last();_.val(a),_.trigger("change");let n=Object.keys(e);t.each(n,function(_){let i=n[_],c=e[n[_]],l=t('[name="acym_action[filters]['+o+"]["+t("#acym__automation__filters__count__and").val()+"]["+a+"]["+i+']"]');t.setFieldValue(l,c),l.trigger("change")})}),_++}),o++}),_()}()});