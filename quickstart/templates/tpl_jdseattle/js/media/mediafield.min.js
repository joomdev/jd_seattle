;(function($){'use strict';if(!Function.prototype.bind){Function.prototype.bind=function(a){if(typeof this!=='function'){throw new TypeError('Function.prototype.bind - what is trying to be bound is not callable');}var b=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound}}$.fieldMedia=function(a,b){this.options=$.extend({},$.fieldMedia.defaults,b);this.$container=$(a);this.$modal=this.$container.find(this.options.modal);this.$modalBody=this.$modal.children('.modal-body');this.$input=this.$container.find(this.options.input);this.$containerPreview=this.$container.find(this.options.previewContainer);this.$buttonSelect=this.$container.find(this.options.buttonSelect);this.$buttonClear=this.$container.find(this.options.buttonClear);this.$buttonSelect.on('click',this.modalOpen.bind(this));this.$buttonClear.on('click',this.clearValue.bind(this));this.$modal.on('hide',this.removeIframe.bind(this));this.updatePreview()};$.fieldMedia.prototype.modalOpen=function(){var c=$('<iframe>',{name:'field-media-modal',src:this.options.url.replace('{field-media-id}',this.$input.attr('id')),width:this.options.modalWidth,height:this.options.modalHeight});this.$modalBody.append(c);this.$modal.modal('show');$('body').addClass('modal-open');var d=this;c.load(function(){var b=$(this).contents();b.on('click',d.options.buttonSaveSelected,function(){var a=b.find('#f_url').val();if(a){d.setValue(a)}d.modalClose.call(d)});b.on('click','.button-cancel',function(){$('body').removeClass('modal-open');d.modalClose.bind(d)})})};$.fieldMedia.prototype.modalClose=function(){this.$modal.modal('hide');$('body').removeClass('modal-open');this.$modalBody.empty()};$.fieldMedia.prototype.removeIframe=function(){this.$modalBody.empty();$('body').removeClass('modal-open')};$.fieldMedia.prototype.setValue=function(a){this.$input.val(a).trigger('change');this.updatePreview()};$.fieldMedia.prototype.clearValue=function(){this.setValue('')};$.fieldMedia.prototype.updatePreview=function(){if(!this.options.preview){return}if(this.options.preview&&!this.options.previewAsTooltip){var a=this.$input.val();if(!a){this.$containerPreview.append('')}else{var b=new Image();b.src=this.options.basepath+a;if(b.width>b.height){this.$containerPreview.html($('<img>',{src:b.src,style:'width: '+this.options.previewWidth+'px'}))}else{this.$containerPreview.html($('<img>',{src:b.src,style:'height: '+this.options.previewHeight+'px'}))}}}else{try{this.$containerPreview.popover('dispose');this.$input.tooltip('dispose')}catch(err){}var a=this.$input.val();if(!a){this.$containerPreview.popover()}else{var b=new Image(this.options.previewWidth,this.options.previewHeight);b.src=this.options.basepath+a;this.$containerPreview.popover({content:b});this.$input.tooltip({placement:'top',title:a})}}};$.fieldMedia.defaults={basepath:'',buttonClear:'.button-clear',buttonSelect:'.button-select',buttonSaveSelected:'.button-save-selected',input:'.field-media-input',preview:true,previewAsTooltip:true,previewContainer:'.field-media-preview',previewWidth:200,previewHeight:200,url:'index.php?option=com_media&tmpl=component',modal:'.modal',modalWidth:'100%',modalHeight:'300px',};$.fn.fieldMedia=function(c){return this.each(function(){var a=$(this),instance=a.data('fieldMedia');if(!instance){var b=b||{},data=a.data();for(var p in data){if(data.hasOwnProperty(p)){b[p]=data[p]}}instance=new $.fieldMedia(this,b);a.data('fieldMedia',instance)}})};$(document).ready(function(){$('.field-media-wrapper').fieldMedia()})})(jQuery);function jInsertFieldValue(a,b){var $=jQuery.noConflict();var c=$("#"+b).val();if(c!=a){var d=$("#"+b);d.val(a);d.trigger("change");if(typeof(d.get(0).onchange)==="function"){d.get(0).onchange()}jMediaRefreshPreview(b)}}function jMediaRefreshPreview(a){var $=jQuery.noConflict();var b=$("#"+a).val();var c=$("#"+a+"_preview");var d=$("#"+a).data("basepath");if(c.length){if(b){c.attr("src",d+b);$("#"+a+"_preview_empty").hide();$("#"+a+"_preview_img").show()}else{c.attr("src","");$("#"+a+"_preview_empty").show();$("#"+a+"_preview_img").hide()}}}function jMediaRefreshPreviewTip(d){var $=jQuery.noConflict();var e=$(d);var f=e.find("img.media-preview");f.each(function(a,b){e.find("div.tip").css("max-width","none");var c=$(this).attr("id");c=c.substring(0,c.length-"_preview".length);jMediaRefreshPreview(c);e.show(this)})}function jMediaRefreshImgpathTip(a,b){var $=jQuery.noConflict();var c=$(a);c.css("max-width","none");var d=$(b).val();$("#TipImgpath").html(d);if(d.length){c.show()}else{c.hide()}}
